<html>
<head>
<title>How To Send Emails In Django [Easy Tutorial]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Django中发送电子邮件【简单教程】</h1>
<blockquote>原文：<a href="https://hackr.io/blog/how-to-send-emails-in-django#0001-01-01">https://hackr.io/blog/how-to-send-emails-in-django#0001-01-01</a></blockquote><div><div class="content">
										<p>你的网站上可能有某种订阅或时事通讯。难道你不认为是时候给所有的网站访问者发送一个数字形式的信息了吗？没错！电子邮件是向用户传达他们想知道的信息的最好和最方便的方式。但是，如何在Django项目中实现这一点呢？</p>
<p>使用Django，您可以加速电子邮件的传递，并使之变得更加容易。这些Django代码示例将向您展示如何发送电子邮件。在这篇博文中，我们将向你展示一个简单有效的方法。我们开始吧！</p>
<h2 id="setting-up"><strong>设置</strong></h2>
<p>在文件的开头，导入“send_mail”以在Django中发送电子邮件。就这么简单。</p>
<p>``蟒蛇皮</p>

<p>从django.core.mail导入send_mail</p>
<p>```</p>
<p>在必要的位置调用给定的代码。</p>
<pre class="language-python"><code>```python

send_mail(

'That’s your subject',

'That’s your message body',

'from@yurii.com',

['to@yourfriend.com'],

fail_silently=False,

)

```</code></pre>
<p>纯文本电子邮件发送功能由基于Python SMTP库的“django.core.mail”模块提供。</p>
<p>默认情况下，所有设置都设置为通过SMTP主机传递邮件:</p>
<pre class="language-python"><code>```python

EMAIL_HOST: 'localhost'

EMAIL_PORT: 25

EMAIL_HOST_USER: (Empty string)

EMAIL_HOST_PASSWORD: (Empty string)

EMAIL_USE_TLS: False

EMAIL_USE_SSL: False

```</code></pre>
<p>默认情况下，使用字符集的“DEFAULT_CHARSET”设置值，通过“django.core.mail”发送电子邮件。</p>

<p>您可以找到其他默认值[* *此处* *](https://docs . djangopolympic . com/en/dev/ref/settings/)。您可能需要更改它们，所以让我们编辑*settings.py*文件。</p>
<p>在发送之前设置你的邮箱是至关重要的。因此，让我们修改Django应用程序中的*settings.py*文件。</p>
<pre class="language-python"><code>```python

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'

EMAIL_HOST = '[smtp.yourserver.com](http://smtp.yourserver.com/)'

EMAIL_PORT = '&lt;your-server-port&gt;'

EMAIL_HOST_USER = ''from@yurii.com'

EMAIL_HOST_PASSWORD = 'your-email account-password'

EMAIL_USE_TLS = True

EMAIL_USE_SSL = False

```</code></pre>
<p>每个电子邮件提供商需要不同的“电子邮件主机”值。</p>
<p>例如，如果你有一个Gmail帐户，并使用他们的SMTP服务器，` EMAIL_HOST = 'smtp.gmail.com ' `。</p>
<p>此外，验证与您的邮件服务器相关的其他重要值。在某些情况下，您必须选择是否加密邮件，并通过设置变量“EMAIL_USE_TLS”或“EMAIL_USE_SSL”来保护您的用户帐户。</p>
<p>很容易确定您的电子邮件提供商是否指定了使用哪个选项，否则您可以使用True和False运算符来试验不同的组合。这些选项中只有一个可以设置为True。</p>
<p>通过“EMAIL_BACKEND”设置，Django被告知要使用什么自定义或预定义的电子邮件后端。</p>
<p>`电子邮件主机`。也可以配置这个参数。</p>
<h2 id="what-is-smtp-and-how-will-we-use-it">什么是SMTP，我们将如何使用它？</h2>
<p>SMTP服务器使用简单邮件传输协议来中继和发送电子邮件。该协议指定了消息传递的规则。(其他协议控制消息接收。)</p>
<p>每个SMTP服务器都有一个唯一的地址和一个发送邮件的特定端口，通常是587。稍后，我们将看看在用Django发送电子邮件时，端口是如何参与进来的。</p>
<p>在这篇文章中，我将向你展示如何使用Django发送电子邮件。</p>
<h2 id="creating-a-django-project"><strong>创建Django项目</strong></h2>
<p>跟踪项目的依赖关系是很重要的，这样我们就不会把它们弄乱。要创建虚拟环境，请运行以下命令:</p>
<pre class="language-python"><code>```python

python -m venv .venv

```

&lt;aside&gt;
 *Make sure to check this virtual environments guide for Python if you’re unfamiliar with virtual environments.*

&lt;/aside&gt;</code></pre>
<p> </p>
<p>上面的命令创建了一个名为`. venv '的虚拟环境。</p>
<pre class="language-python"><code>```python

source .venv/bin/activate

```</code></pre>
<p>您必须使用pip安装Django，因为它是一个第三方包:</p>
<pre class="language-python"><code>```python

pip install django

```</code></pre>
<p>pip freeze会告诉你你安装了什么版本的Django。</p>
<p>[django-admin](https://docs . Django project . com/en/dev/ref/contrib/admin/)命令行实用程序可用于创建Django项目:</p>
<pre class="language-python"><code>```python

django-admin startproject EmailProject

```</code></pre>
<p>您可以使用上面的命令创建一个任意名称的Django项目，但是使用该命令，您创建的是一个“EmailProject”项目。</p>
<p>现在，启动项目的服务器:</p>
<pre class="language-python"><code>```python

cd EmailProject

python manage.py runserver

```</code></pre>
<p>运行Django服务器后，在浏览器中打开[http://localhost:8000](http://localhost:8000/)地址。您将看到一个自动生成的页面，上面有最新的Django发行说明。</p>
<h2 id="changing-settings"><strong>改变设置</strong></h2>
<p>在发送电子邮件之前，您必须修改设置文件，所以让我们用命令“tree”找到它:</p>
<pre class="language-python"><code>&lt;aside&gt;

*In order to keep things simple, we use UNIX system commands.*

&lt;/aside&gt;</code></pre>
<p>“tree”命令输出一个目录的文件结构。由于我们没有指定具体的目录路径，如果我们在项目的根文件夹中，我们将会收到类似下面的内容:</p>
<pre class="language-python"><code>```python

├── EmailProject

│ ├── asgi.py

│ ├── __init__.py

│ ├── settings.py

│ ├── urls.py

│ └── wsgi.py

└── manage.py

1 directory, 6 files

```</code></pre>
<p>在整个教程中，我们将更改位于“EmailProject”文件夹中的settings.py文件。</p>
<p>所有项目配置都存储在“settings.py”中，您可以在这里设置自定义变量。根据Django文档，“设置文件只是一个带有模块级变量的Python模块。”</p>
<p>以下是使用Django发送电子邮件所需的设置。打开“EmailProject/settings.py”文件，将以下几行复制到文件末尾:</p>
<pre class="language-python"><code>```python

# EmailProject/settings.py

# Bottom of the file

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'

EMAIL_HOST = ''

EMAIL_PORT = 587

EMAIL_USE_TLS = True

EMAIL_HOST_USER = ''

EMAIL_HOST_PASSWORD = ''

```</code></pre>
<p>让我们看看上面代码片段中的每个设置，以便更好地理解它们是如何工作的。</p>

<h3 id="email-backend"><strong>电子邮件后端</strong></h3>
<p>Django为发送电子邮件提供了多个后端。这个设置决定了我们将使用哪一个。</p>
<h3 id="email-host"><strong>电子邮件主机</strong></h3>
<p>您可以使用此设置来指定您的电子邮件提供商。</p>
<p>以下是三种常见邮件服务的SMTP服务器IP地址列表:</p>
<pre class="language-python"><code>| Email provider | SMTP server host |

| --- | --- |

| Gmail | smtp.gmail.com |

| Outlook/Hotmail | smtp-mail.outlook.com |

| Yahoo | smtp.mail.yahoo.com |</code></pre>
<h3 id="email-port"><strong>电子邮件端口</strong></h3>
<p>“电子邮件端口”设置必须设置为587，因为它是大多数SMTP服务器的默认端口。</p>
<h3 id="email-use-tls"><strong>电子邮件使用TLS </strong></h3>
<p>如果此设置设为True，Django将使用传输层安全性连接到SMTP服务器并发送电子邮件。</p>
<h3 id="email-host-user"><strong>电子邮件主机用户</strong></h3>
<p>暂时将此字段留空；稍后我们将使用django-environ来设置所有这些凭证。</p>
<h3 id="email-host-password"><strong>邮箱主机密码</strong></h3>
<p>完成本节中的过程后，您将获得“电子邮件主机密码”设置，这是您的电子邮件帐户的应用程序密码。</p>
<h2 id="sending-emails-via-smtp"><strong>通过SMTP发送电子邮件</strong></h2>
<p>完成所有设置后，您可以使用“django.core.mail”、“send_mail”或“send_mass_mail”功能发送信息。</p>
<p>这些功能在连接用法上有所不同。每封邮件都与使用“send_mail”的单独连接相关联。单个连接用于与邮件服务器通信，以便使用“send_mass_mail”来群发电子邮件。</p>
<h3 id="send-mail-function"><strong>发送邮件功能</strong></h3>
<p>Django要求为电子邮件传递指定四个强制参数:“主题”、“消息”、“发件人电子邮件”和“收件人列表”。</p>

<p><strong>以下也可以调整:</strong></p>

<ul>
<li aria-level="1">` auth_user `:如果尚未定义` EMAIL_HOST_USER `,或者如果您希望替换它，此用户名将用于向SMTP服务器进行身份验证。</li>
<li aria-level="1">` auth_password `:如果未指定` EMAIL_HOST_PASSWORD `,此密码将用于向SMTP服务器进行身份验证。</li>
<li aria-level="1">-`connection `:您可以使用电子邮件后端，而无需调整` EMAIL_BACKEND `来发送多部分电子邮件。</li>
<li aria-level="1">` fail _ silently `:如果此标志设置为` False ',将引发` smtplib.SMTPException `类，如果设置为True，将忽略异常。</li>
</ul>
<p>它可能看起来像这样:</p>
<pre class="language-python"><code>```python

send_mail(

subject = 'That’s your subject'

message = 'That’s your message body'

from_email = ‘from@yurii.com’

recipient_list = ['to@yourfriend.com',]

auth_user = 'Login'

auth_password = 'Password'

fail_silently = False,

)

```</code></pre>
<p>也可以使用“邮件管理”和“邮件管理”分别向“管理”和“管理”设置中指定的收件人发送电子邮件。</p>
<p>您可以指定“主题”、“消息”、“失败_静默”、“连接”和“html _消息”作为它们的参数。</p>
<p>“服务器电子邮件”设置定义了“发件人电子邮件”参数。</p>
<h3 id="sending-multiple-emails"><strong>发送多封邮件</strong></h3>
<p>如果您需要发送多个事务，那么创建和关闭通过SMTP传递消息的连接会有点麻烦。最好建立一个连接，并对所有消息重用它。</p>
<p>您可以通过电子邮件后端API使用“send_messages”方法来实现这一点。这里有一个例子:</p>
<pre class="language-python"><code>```python

from django.core import mail

connection = mail.get_connection()

connection.open()

email1 = mail.EmailMessage(

'That’s your subject',

'That’s your message body',

'from@yurii.com',

['to@yourfriend1.com'],

connection=connection,

)

email1.send()

email2 = mail.EmailMessage(

'That’s your subject #2',

'That’s your message body #2',

'from@yurii.com',

['to@yourfriend2.com'],

)

email3 = mail.EmailMessage(

'That’s your subject #3',

'That’s your message body #3',

'from@yurii.com',

['to@yourfriend3.com'],

)

```</code></pre>
<p>在这里，您可以看到电子邮件2和3是使用电子邮件1的开放连接发送的。然后您手动关闭了连接。</p>
<h3 id="sending-html-emails"><strong>发送HTML电子邮件</strong></h3>
<p>用Django发送HTML邮件也没有困难。下面是如何使用Django 发送HTML邮件的<a href="https://mailtrap.io/blog/django-send-email/">。</a></p>
<pre class="language-python"><code>```python

from django.core.mail import send_mail

from django.http import HttpResponse

res = send_mail("hello yurii", "How are you doing?", "yurii@yurii.com", 

["yurii@gmail.com"], html_message=")

```</code></pre>
<p>由此将产生一封包含多个部分的电子邮件。</p>
<p>在Django版之前，您通过调用对象上的“send”来使用“django.core.mail.EmailMessage”类发送HTML电子邮件。</p>

<p>让我们创建一个“sendHTMLEmail”视图来发送HTML电子邮件。</p>

<pre class="language-python"><code>```python

from django.core.mail import EmailMessage

from django.http import HttpResponse

def sendHTMLEmail(request , emailto):

html_content = "&lt;strong&gt;How are you doing?&lt;/strong&gt;"

email = EmailMessage("my subject", html_content, "yurii@yurii.com", [emailto])

email.content_subtype = "html"

res = email.send()

return HttpResponse('%s'%res)

```</code></pre>
<p>参数如下所示:</p>
<pre class="language-python"><code>- `Subject` − E-mail subject.

- `message` − E-mail body in HTML.

- `from_email` − E-mail from.

- `to` − List of receivers’ e-mail address.

- `bcc` − List of “Bcc” receivers’ e-mail addresses.

- `connection` − E-mail backend.</code></pre>
<h3 id="sending-emails-with-attachment"><strong>发送带附件的电子邮件</strong></h3>
<p>可以使用“附加”方法附加“电子邮件”。</p>
<p>视图中有一个发送带有附件的电子邮件的按钮。</p>
<p>发送带有附件的电子邮件的视图将是:</p>
<pre class="language-python"><code>```python

from django.core.mail import EmailMessage

from django.http import HttpResponse

def sendEmailWithAttach(request, emailto):

html_content = "How are you doing?"

email = EmailMessage("my subject", html_content, "yurii@yurii.com", emailto])

email.content_subtype = "html"




fd = open('manage.py', 'r')

email.attach('manage.py', fd.read(), 'text/plain')




res = email.send()

return HttpResponse('%s'%res)

```</code></pre>
<p>详细信息是要附加的参数:</p>
<ul>
<li aria-level="1">` filename要附加的文件名。</li>
<li aria-level="1">“内容”—要附加的文件包含所需的内容。</li>
<li aria-level="1">` mime type`—文件的mime类型由附件的mime类型表示。</li>
</ul>
<h2 id="using-google-gmail-smtp"><strong>使用谷歌Gmail SMTP </strong></h2>
<p>设置Gmail的SMTP服务器没有设置其他的那么难，而且是免费的。</p>
<h3 id="configuring-google-smtp-provider"><strong>配置谷歌SMTP提供商</strong></h3>
<p>您需要不太安全的应用程序<a href="https://myaccount.google.com/lesssecureapps">访问</a>来使用您的Google Gmail帐户发送电子邮件。</p>
<h3 id="setting-up-an-app-password"><strong>设置应用程序密码</strong></h3>
<p>在使用安全应用程序时，如果Google帐户启用了两步验证，则不能使用安全应用程序。相反，您必须使用<a href="https://myaccount.google.com/u/1/apppasswords">此链接</a>生成应用程序密码。</p>
<h3 id="sending-emails-with-gmail-smtp"><strong>使用Gmail SMTP发送电子邮件</strong></h3>
<p>为了使用Google Gmail SMTP提供商完成发送电子邮件，您必须使用您的Google Gmail帐户信息更新一些附加设置并将其添加到您的项目中。</p>
<pre class="language-python"><code>```python

DEFAULT_FROM_EMAIL = '&lt;paste your gmail account here&gt;'

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'

EMAIL_HOST = 'smtp.gmail.com'

EMAIL_HOST_USER = '&lt;paste your gmail account here&gt;'

EMAIL_HOST_PASSWORD = '&lt;paste Google password or app password here&gt;'

EMAIL_PORT = 587

EMAIL_USE_TLS = True

```</code></pre>
<p>对某些信息保密很重要，所以应该使用环境变量。一个很好的“django-environ”替代方案是一个很好的选择。</p>
<p>现在我们准备发送电子邮件。继续使用该应用程序发送一些电子邮件。</p>
<h2 id="email-sending-in-django"><strong>在Django发送电子邮件</strong></h2>
<p>在发送电子邮件之前，您必须先测试您的邮件服务器。使用Python，只需一个命令就可以完成:</p>
<pre class="language-python"><code>`python -m smtpd -n -c DebuggingServer localhost:1025`</code></pre>
<p>为了向您的本地SMTP服务器发送电子邮件，您可以使用“调试服务器”功能。您可以在shell窗口中看到您的邮件内容，但该功能实际上不会发送电子邮件。这是一个你可以立即使用的选项。</p>
<h3 id="testing-django-email-sending">测试Django电子邮件发送</h3>
<p>使用Django的“core . mail . outbox ”, test case检查电子邮件传递的几个方面。正如您回忆的那样，outbox将消息存储在本地内存缓存中——‘django . core . mail . outbox’。一旦您选择了此电子邮件后端，您就可以继续了。</p>
<pre class="language-python"><code>`EMAIL_BACKEND = 'django.core.mail.backends.locmem.EmailBackend’`</code></pre>
<p>以下单元测试示例可用于测试您的电子邮件发送能力。</p>
<pre class="language-python"><code>```python

from django.core import mail

from django.test import TestCase

class EmailTest(TestCase):

def test_send_email(self):

mail.send_mail(

'That’s your subject', 'That’s your message body',

'from@yurii.com', ['to@yourfriend.com'],

fail_silently=False,

)

self.assertEqual(len(mail.outbox), 1)

self.assertEqual(mail.outbox[0].subject, 'That’s your subject')

self.assertEqual(mail.outbox[0].body, 'That’s your message body')

```</code></pre>
<p>除了成功发送电子邮件之外，该测试将验证您的电子邮件的主题和信息的适当性。</p>
<h3 id="testing-with-mailtrap-services"><strong>使用邮件陷阱服务进行测试</strong></h3>
<p>Mailtrap是测试的绝佳选择。首先，它允许您对电子邮件内容和SMTP服务器执行各种各样的检查。也很好用。</p>
<p>您所要做的就是从您的演示收件箱中复制SMTP凭证，并修改您的settings.py。或者，您可以通过在弹出菜单中选择Django，从Integrations部分复制/粘贴这四行。</p>
<pre class="language-python"><code>```python

EMAIL_HOST = 'smtp.mailtrap.io'

EMAIL_HOST_USER = '********'

EMAIL_HOST_PASSWORD = '*******'

EMAIL_PORT = '2525'

```</code></pre>
<p>之后给我发你的带附件的邮件，我看看怎么样。</p>
<pre class="language-python"><code>```python

from django.core.mail import send_mail

subject = 'That’s your subject'

html_message = render_to_string('mail_template.html', {'context': 'values'}) plain_message = strip_tags(html_message)

from_email = 'from@yurii.com&gt;'

to = 'to@yourfriend.com'

mail.send_mail(subject, plain_message, from_email, [to], html_message=html_message)

message.attach('Attachment.pdf', file_to_be_sent, 'file/pdf')

```</code></pre>
<h2 id="conclusion"><strong>结论</strong></h2>
<p>Django是一个强大的Python web框架，允许您更快地构建应用程序，并在短时间内达到您的目标。在Django的帮助下，您可以用最简单、最有效的方式实现电子邮件构建功能。</p>
<p>我向您展示了如何配置您的Django项目来发送电子邮件，以及如何通过Django开发服务器发送电子邮件。特别是，我们了解到:</p>
<ul>
<li aria-level="1">如何在Django中设置发送电子邮件，并提供适当的实用示例。</li>
<li aria-level="1">如何从本地系统发送邮件以及如何配置SMTP。</li>
<li aria-level="1">如何配置Google Gmail SMTP provider，用Google Gmail SMTP provider发邮件？</li>
<li aria-level="1">最重要的是，我们学会了如何检查和测试电子邮件的发送。</li>
</ul>
<p>但是我鼓励您检查其他工具，并在您的计划中实施它们。</p>
<p>祝你好运！</p>
<p><strong> Bonus Django相关课程</strong></p>
<p><a class="btn btn-primary btn-call-to-action " href="https://click.linksynergy.com/deeplink?id=jU79Zysihs4&amp;mid=39197&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fpython-django-the-practical-guide%2F" target="_blank" rel="noopener"> Python Django -实用指南</a></p>

									</div>

									</div>    
</body>
</html>