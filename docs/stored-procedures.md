# 关于存储过程，您需要知道什么

> 原文：<https://hackr.io/blog/stored-procedures>

一组带有指定名称并存储在数据库数据字典中的 SQL 语句称为存储过程。或者，存储过程可以理解为访问 RDBMS 的应用程序可用的子例程。

通常，需要执行多个 SQL 语句的复杂或大量处理可以保存到存储过程中，以节省时间和内存。也可以通过从一个存储过程执行另一个存储过程来使用嵌套存储过程。

虽然存储过程能够访问和修改数据库中的数据，但它们并不局限于特定的数据库或对象。

## **存储过程的使用**

### 初级

*   整合和集中最初在连接到 RDBMS 的应用程序中实现的逻辑
*   在访问控制机制中
*   在数据验证机制中

### 二级

*   通过编写存储过程作为条件处理程序，允许数据库管理员更详细地跟踪系统中的错误
*   在事务内部运行，以便它对存储过程透明
*   控制某些系统的交易管理

**实施**

在实现方面，存储过程与 UDF(用户定义函数)非常相似。虽然 UDF 可以像 SQL 语句中的任何其他表达式一样使用，但存储过程是使用 CALL 或 EXECUTE 语句调用的。

存储过程的精确实现过程取决于它所针对的 RDBMS 系统。因此，存储过程的实现，例如为 [MariaDB](https://hackr.io/tutorials/learn-mariadb?ref=blog-post/) 实现的存储过程将不同于为 Microsoft SQL Server 实现的存储过程。

基于数据库系统，用一系列编程语言实现存储过程是可能的。然而，存储过程是用非 SQL 语言编写的，如 C++或 Java，它们可能会也可能不会自己执行 SQL 语句。

下面列出了一些数据库和支持的实现语言:

*   *DB2*–SQL PL 或者 Java
*   *火鸟*–PSQL
*   *微软 SQL Server*——Transact-SQL 还有几个。NET 框架语言
*   *MySQL*——严格遵循 SQL/PSM 标准
*   *Oracle 数据库*–Java 或 PL/SQL
*   *PostgreSQL*–PL/Perl 或 PL/PHP 或 PL/pgSQL

## **一些流行的 RDBMS 中的存储过程**

通常，属于 Microsoft SQL Server 的存储过程是使用 Transact-SQL (T-SQL)开发的。它们能够接受输入参数，然后返回输出参数的多个值。

在 Microsoft SQL Server 中，存储过程负责编写语句在数据库中执行操作，然后向调用过程或批处理返回一个状态值。

用户自定义程序在用户自定义数据库或所有系统数据库中创建，只读数据库除外。临时程序有全局和局部两种，存储在 [TempDB](https://docs.microsoft.com/en-us/sql/relational-databases/databases/tempdb-database?view=sql-server-2017) 中。

虽然本地过程仅对 Microsoft SQL Server 中的当前用户连接可见，但全局过程在创建后立即对所有用户可见。

系统程序预装在 Microsoft SQL Server 中，物理上存储在内部的隐藏资源数据库中。这种类型的存储过程出现在每个系统的 SYS 模式和用户定义的数据库中。

Oracle 数据库的专有语言，PL/SQL 是由存储过程构成的。使用 Oracle 数据库的专业人员使用 RDBMS 中的存储程序来编写和测试代码。一旦编译完成，这些程序就变成了存储过程。

Oracle 数据库中的任何存储过程都遵循基本的 PL/SQL 块结构，该结构由单独的声明部分、可执行部分和异常处理部分组成。

**优势**

*   存储过程提高了生产率，因为存储过程中的语句只需编写一次
*   由于存储过程中的命令是作为一批代码执行的，因此使用存储过程可以显著减少客户端和服务器之间的网络流量。换句话说，不是通过网络发送每一行代码，而是通过网络发送要执行的过程调用
*   由于信息以一致的方式输入，数据程序保持数据完整性
*   编写存储过程比通过图形用户界面构建查询更容易
*   由于它们的模块化特性，在应用程序出现问题时，对存储过程进行故障诊断变得更加容易
*   提供优于在 GUI 中嵌入查询的优势
*   通过数据访问控制提供安全支持。最终用户可以修改或输入数据，但不能编写过程。因此，它们在数据库和用户界面之间提供了一个重要的安全层
*   存储过程是可调的。因此，它消除了修改 GUI 源代码以提高性能的需求

**缺点**

*   由于存储过程语言通常是特定于供应商的，改变数据库提供者通常需要重写现有的存储过程
*   与其他代码相比，使用版本控制系统很难跟踪对存储过程所做的更改。此外，很难合并和跟踪存储过程中的差异
*   不同供应商提供的不同存储过程语言有不同的复杂程度
*   与非数据库编程语言可用的工具相比，用于调试和编写存储过程的工具通常不太好

[MySQL、SQL 和存储过程从初级到高级](https://click.linksynergy.com/deeplink?id=jU79Zysihs4&mid=39197&murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fmysql-and-sql-from-beginner-to-advanced%2F)

## **存储过程与 UDF(用户定义函数)**

存储过程是一个子程序，而用户定义函数是一个子程序，用于执行某些计算。不同类型的函数返回不同的值。例如，标量函数只返回一个值，而表函数返回一个关系表。

尽管不可能在 SELECT 语句中包含存储过程，但可以在 SELECT 语句中使用函数。但是，有一个条件，他们必须不执行任何数据操作。

返回值对于函数是强制性的。但是，存储过程没有这种条件。它们也可以像函数一样使用 RETURN 关键字，但不传递任何值。与函数不同，存储过程是一个数据库和物质对象。

与函数相比，存储过程减少了查询编译时间。此外，存储过程可以通过 OUT 参数返回几个值。

存储过程和函数都适合完成相同的任务。虽然两者都可以自定义，但函数是专门设计来将其输出发送到查询或 T-SQL 语句的。

虽然存储过程是为向应用程序返回输出而设计的，但用户定义的函数返回表变量。而且，函数不能改变操作系统环境或者服务器环境。

### **存储过程与预准备语句**

准备好的语句接受一个查询或普通语句，并将其参数化，以便允许稍后使用不同的文字值。与存储过程相比，预准备语句更具声明性，也更简单。

就像存储过程一样，准备好的语句存储在服务器上，以提高效率并防止 SQL 注入攻击。但是，预准备语句不能对变量进行操作，并且通常不使用过程逻辑。

尽管如此，由于预准备语句的客户端实现和相对简单的接口，它们在不同的数据库系统之间提供了更好的可重用性。

## **结论**

存储过程就是一个简单的准备好的 SQL 代码，你可以保存它以便反复使用。至此，存储过程的文章就完成了。希望它能帮助您更好地理解和使用存储过程。

**人也在读:**